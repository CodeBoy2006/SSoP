<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="description" content="购物车" />
    <meta name="keywords" content="购物车" />
    <title>购物车</title>
    <link rel="stylesheet" type="text/css" href="/static/css/shopcar.css">
    <script type="text/javascript" src="/static/js/auto-size.js"></script>
    <script type="text/javascript" src="/static/js/jquery-2.1.4.min.js"></script>
    <script>

        String.format = function() {
            if (arguments.length == 0)
                return null;
            var str = arguments[0];
            for ( var i = 1; i < arguments.length; i++) {
                var re = new RegExp('\\{' + (i - 1) + '\\}', 'gm');
                str = str.replace(re, arguments[i]);
            }
            return str;
            /*
            调用方式：
                var info = "我喜欢吃{0}，也喜欢吃{1}，但是最喜欢的还是{0},偶尔再买点{2}。";
                var msg=String.format(info , "苹果","香蕉","香梨")
                alert(msg);
                输出:我喜欢吃苹果，也喜欢吃香蕉，但是最喜欢的还是苹果,偶尔再买点香梨。
            */
        };
    </script>
</head>
<body>
<div class="fix_head">
    <a href="javascript:history.go(-1);" class="back">
        <img src="/static/img/images/cart/back.jpg">
    </a>
    <p>购物车</p>
</div>
<div class="sc_h"></div>
<div class="bigbox">
    <div class="lb">
        <div class="check">
            <div class="xz" data="0"></div>
        </div>
        <img src="/static/img/images/cart/spt.jpg" class="spt">
        <div class="mid">
            <p class="name">韩国正品自然乐园芦荟补水保湿洗面奶男士女控油祛</p>
            <p class="color">颜色:白色</p>
            <div class="jj">
                <span class="jian">-</span>
                <input class="num" value="1">
                <span class="jia">+</span>
            </div>
        </div>
        <div class="jgq">
            <div class="price"><p>￥<span class="pri">12.00</span></p></div>
            <div class="price_de"><p><del>￥30.00</del></p></div>
            <img src="/static/img/images/cart/del.jpg" class="del">
        </div>
    </div>
</div>

<div class="fix_bottom">
    <div id="qx" data="0"></div><span style="float:left;line-height:0.8rem;">全选</span>
    <div class="zjq">
        <p class="p1">合计:￥
            <span id="zj" >0</span>
        </p>
        <p>含运费</p>
    </div>
    <a id="js">结算(<span id="zsl">0</span>)</a>
</div>
<script type="text/javascript">

    function additem(img,amount,updatetime,name,price) {
        itemt=`<div class="lb">
                        <div class="check">
                            <div class="xz" data="0"></div>
                        </div>
                        <img src="{0}" class="spt">
                        <div class="mid">
                            <p class="name">{3}</p>
                            <p class="color">{2}</p>
                            <div class="jj">
                                <span class="jian">-</span>
                                <input class="num" value="{1}">
                                <span class="jia">+</span>
                            </div>
                        </div>
                        <div class="jgq">
                            <div class="price"><p>￥<span class="pri">{4}</span></p></div>
                            <div class="price_de"><p><del>￥{4}</del></p></div>
                            <img src="/static/img/images/cart/del.jpg" class="del">
                        </div>
                    </div>`;
        $(".bigbox").append(String.format(itemt,img,amount,updatetime,name,price));
    }
    function getinfo(id)
    {
        $.ajax({
            url: "/store/cart/getlist",
            type: "post",
            data: {
                productid:id
            },
            success: function (res) {
                console.log(res);
                if (res == "0") {
                    console.log("提交失败");
                } else {
                    return res;
                }
            }
        })
    }
    $(document).ready(function (){
        $.ajax({
            url: "/store/product/singleinfo",
            type: "post",
            success: function (res) {
                console.log(res);
                if (res == "0") {
                    alert("提交失败");
                } else {
                    for(j = 0,len=res.length; j < len; j++) {
                        console.log(res[j]["productid"]);
                        console.log(getinfo(res[j]["productid"]));
                        additem();
                    }

                }
            }
        })

    });

    $(function(){
        js();
        $(".xz").click(function(){
            var a = $(this).attr("data");
            if (a==0) {
                $(this).css("background-image","url(/static/img/images/cart/check_on.jpg)");
                $(this).attr("data",1)
            }else{
                $(this).css("background-image","url(/static/img/images/cart/check.jpg)");
                $(this).attr("data",0)
                $("#qx").attr("data",0);
                $("#qx").css("background-image","url(/static/img/images/cart/check.jpg)");
            }
            js();

        })
        $("#qx").click(function(){
            var a = $(this).attr("data");
            if (a==0) {
                $(".xz").attr("data",1);
                $(this).css("background-image","url(/static/img/images/cart/check_on.jpg)");
                $(".xz").css("background-image","url(/static/img/images/cart/check_on.jpg)");
                $(this).attr("data",1);
            }else{
                $(".xz").attr("data",0);
                $(this).css("background-image","url(/static/img/images/cart/check.jpg)");
                $(".xz").css("background-image","url(/static/img/images/cart/check.jpg)");
                $(this).attr("data",0);
            }
            js();
        })
        $(".jia").click(function(){

            var a = $(this).prev().val();
            a++;
            $(this).prev().val(a);
            js();

        })
        $(".jian").click(function(){

            var a = $(this).next().val();
            if(a<=1){
                return;
            }
            a--;
            $(this).next().val(a);
            var a = $(".xz").attr("data");
            if(a==1){
                js();
            }
        })
        $(".del").click(function(){
            $(this).parent().parent().remove();
            js();
        })
        function js(){

            var num=0;
            var conut=0;
            $(".xz").each(function(){
                if ($(this).attr("data")==1) {
                    var b = $(this).parent().next().next().find(".num").val();
                    var jg = $(this).parent().next().next().next().find(".pri").text();
                    conut+=parseInt(b);
                    num+=b*jg;
                }
            })

            $('#zj').html(num);
            $('#zsl').html(conut);
        }

    })

</script>
</body>
</html>